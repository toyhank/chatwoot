# 邮箱注册登录接口文档

## 基础信息

**Base URL:** `http://172.18.88.87:20108/api/mobile/register`

**Content-Type:** `application/json`

**字符编码:** `UTF-8`

---

## 接口列表

### 1. 检查邮箱是否可用

**接口描述：** 在用户输入邮箱时，实时检查该邮箱是否已被注册

**接口地址：** `GET /check_email`

**请求参数：**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| email | string | 是 | 邮箱地址 |

**请求示例：**

```javascript
// JavaScript Fetch
fetch('http://172.18.88.87:20108/api/mobile/register/check_email?email=user@example.com')
  .then(response => response.json())
  .then(data => console.log(data));
```

```bash
# cURL
curl "http://172.18.88.87:20108/api/mobile/register/check_email?email=user@example.com"
```

**成功响应：**

```json
{
  "status": 200,
  "msg": "ok",
  "data": {
    "email": "user@example.com",
    "available": true,
    "message": "该邮箱可以使用"
  }
}
```

**邮箱已被注册：**

```json
{
  "status": 200,
  "msg": "ok",
  "data": {
    "email": "user@example.com",
    "available": false,
    "message": "该邮箱已被注册"
  }
}
```

**错误响应：**

```json
{
  "status": 400,
  "msg": "邮箱地址格式不正确"
}
```

---

### 2. 发送注册验证码

**接口描述：** 向指定邮箱发送6位数字验证码，用于用户注册

**接口地址：** `POST /send_code`

**请求参数：**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| email | string | 是 | 邮箱地址 |

**请求示例：**

```javascript
// JavaScript Fetch
fetch('http://172.18.88.87:20108/api/mobile/register/send_code', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    email: 'user@example.com'
  })
})
  .then(response => response.json())
  .then(data => console.log(data));
```

```javascript
// Axios
axios.post('http://172.18.88.87:20108/api/mobile/register/send_code', {
  email: 'user@example.com'
})
  .then(response => console.log(response.data));
```

```bash
# cURL
curl -X POST http://172.18.88.87:20108/api/mobile/register/send_code \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com"}'
```

**成功响应：**

```json
{
  "status": 200,
  "msg": "ok",
  "data": {
    "email": "user@example.com",
    "expire": 300,
    "message": "验证码已发送到您的邮箱，请注意查收"
  }
}
```

**错误响应：**

```json
// 邮箱已被注册
{
  "status": 400,
  "msg": "该邮箱已被注册"
}

// 发送过于频繁
{
  "status": 400,
  "msg": "发送过于频繁，请60秒后再试"
}

// 今日发送次数已达上限
{
  "status": 400,
  "msg": "今日发送次数已达上限"
}

// 邮箱格式错误
{
  "status": 400,
  "msg": "邮箱地址格式不正确"
}
```

**注意事项：**

- 验证码有效期：5分钟（300秒）
- 发送间隔限制：同一邮箱60秒内只能发送一次
- 每日限制：同一邮箱每天最多发送10次
- 验证码格式：6位纯数字

---

### 3. 用户注册

**接口描述：** 使用邮箱验证码完成用户注册

**接口地址：** `POST /register`

**请求参数：**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| email | string | 是 | 邮箱地址 |
| code | string | 是 | 6位验证码 |
| password | string | 是 | 登录密码（6-20位字符） |
| nickname | string | 否 | 用户昵称（不填则使用邮箱前缀） |
| phone | string | 否 | 手机号 |
| appid | string | 否 | 应用ID |

**请求示例：**

```javascript
// JavaScript Fetch
fetch('http://172.18.88.87:20108/api/mobile/register/register', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    email: 'user@example.com',
    code: '123456',
    password: 'password123',
    nickname: '用户昵称'
  })
})
  .then(response => response.json())
  .then(data => console.log(data));
```

```javascript
// Axios
axios.post('http://172.18.88.87:20108/api/mobile/register/register', {
  email: 'user@example.com',
  code: '123456',
  password: 'password123',
  nickname: '用户昵称',
  phone: '13800138000'
})
  .then(response => console.log(response.data));
```

```bash
# cURL
curl -X POST http://172.18.88.87:20108/api/mobile/register/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "code": "123456",
    "password": "password123",
    "nickname": "用户昵称"
  }'
```

**成功响应：**

```json
{
  "status": 200,
  "msg": "ok",
  "data": {
    "uid": 123,
    "email": "user@example.com",
    "nickname": "用户昵称",
    "message": "注册成功"
  }
}
```

**错误响应：**

```json
// 邮箱已被注册
{
  "status": 400,
  "msg": "该邮箱已被注册"
}

// 验证码错误或已过期
{
  "status": 400,
  "msg": "验证码错误或已过期"
}

// 密码长度不符
{
  "status": 400,
  "msg": "密码长度必须在6-20个字符之间"
}

// 邮箱格式错误
{
  "status": 400,
  "msg": "邮箱地址格式不正确"
}
```

**注意事项：**

- 验证码必须在5分钟内使用
- 验证码使用后立即失效
- 密码会加密存储，不可逆
- 同一邮箱只能注册一次

---

### 4. 用户登录

**接口描述：** 使用邮箱和密码进行登录

**接口地址：** `POST /login`

**请求参数：**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| email | string | 是 | 邮箱地址 |
| password | string | 是 | 登录密码 |

**请求示例：**

```javascript
// JavaScript Fetch
fetch('http://172.18.88.87:20108/api/mobile/register/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    email: 'user@example.com',
    password: 'password123'
  })
})
  .then(response => response.json())
  .then(data => {
    if (data.status === 200) {
      // 登录成功，保存用户信息
      localStorage.setItem('userInfo', JSON.stringify(data.data));
      console.log('登录成功', data.data);
    } else {
      console.error('登录失败', data.msg);
    }
  });
```

```javascript
// Axios
axios.post('http://172.18.88.87:20108/api/mobile/register/login', {
  email: 'user@example.com',
  password: 'password123'
})
  .then(response => {
    if (response.data.status === 200) {
      // 登录成功
      const userInfo = response.data.data;
      console.log('登录成功', userInfo);
    }
  })
  .catch(error => {
    console.error('请求失败', error);
  });
```

```bash
# cURL
curl -X POST http://172.18.88.87:20108/api/mobile/register/login \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com", "password": "password123"}'
```

**成功响应：**

```json
{
  "status": 200,
  "msg": "ok",
  "data": {
    "uid": 123,
    "email": "user@example.com",
    "nickname": "用户昵称",
    "avatar": "/statics/default_avatar.png",
    "phone": "",
    "message": "登录成功"
  }
}
```

**错误响应：**

```json
// 邮箱或密码错误
{
  "status": 400,
  "msg": "邮箱或密码错误"
}

// 邮箱格式错误
{
  "status": 400,
  "msg": "邮箱地址格式不正确"
}

// 密码为空
{
  "status": 400,
  "msg": "密码不能为空"
}
```

**注意事项：**

- 密码区分大小写
- 建议前端做密码强度校验
- 登录成功后保存用户信息（uid、email等）用于后续请求

---

## 前端开发建议

### 1. 注册流程

```javascript
// 步骤1: 检查邮箱是否可用（实时校验）
async function checkEmail(email) {
  const response = await fetch(`${baseUrl}/check_email?email=${email}`);
  const data = await response.json();
  return data.data.available;
}

// 步骤2: 发送验证码（带倒计时）
let countdown = 0;
async function sendCode(email) {
  if (countdown > 0) {
    alert(`请${countdown}秒后再试`);
    return;
  }
  
  const response = await fetch(`${baseUrl}/send_code`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({email})
  });
  
  const data = await response.json();
  if (data.status === 200) {
    // 开始60秒倒计时
    countdown = 60;
    const timer = setInterval(() => {
      countdown--;
      if (countdown <= 0) clearInterval(timer);
    }, 1000);
    alert('验证码已发送，请查收邮件');
  } else {
    alert(data.msg);
  }
}

// 步骤3: 提交注册
async function register(formData) {
  const response = await fetch(`${baseUrl}/register`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(formData)
  });
  
  const data = await response.json();
  if (data.status === 200) {
    alert('注册成功！');
    // 跳转到登录页或自动登录
    window.location.href = '/login';
  } else {
    alert(data.msg);
  }
}
```

### 2. 登录流程

```javascript
async function login(email, password) {
  const response = await fetch(`${baseUrl}/login`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({email, password})
  });
  
  const data = await response.json();
  if (data.status === 200) {
    // 保存用户信息
    localStorage.setItem('userInfo', JSON.stringify(data.data));
    localStorage.setItem('uid', data.data.uid);
    
    alert('登录成功！');
    // 跳转到首页
    window.location.href = '/';
  } else {
    alert(data.msg);
  }
}
```

### 3. Vue.js 完整示例

```vue
<template>
  <div class="register-page">
    <!-- 注册表单 -->
    <form @submit.prevent="handleRegister">
      <div class="form-item">
        <input 
          v-model="form.email" 
          type="email" 
          placeholder="请输入邮箱"
          @blur="checkEmailAvailable"
          required
        />
        <span v-if="emailChecked && !emailAvailable" class="error">
          该邮箱已被注册
        </span>
      </div>

      <div class="form-item">
        <input 
          v-model="form.code" 
          placeholder="请输入验证码" 
          maxlength="6"
          required
        />
        <button 
          type="button" 
          @click="sendVerifyCode" 
          :disabled="countdown > 0 || !form.email"
        >
          {{ countdown > 0 ? `${countdown}秒后重试` : '发送验证码' }}
        </button>
      </div>

      <div class="form-item">
        <input 
          v-model="form.password" 
          type="password" 
          placeholder="请输入密码(6-20位)"
          minlength="6"
          maxlength="20"
          required
        />
      </div>

      <div class="form-item">
        <input 
          v-model="form.nickname" 
          placeholder="请输入昵称(可选)"
        />
      </div>

      <button type="submit" :disabled="loading">
        {{ loading ? '注册中...' : '注册' }}
      </button>
    </form>

    <!-- 登录入口 -->
    <div class="login-link">
      已有账号？<a @click="$router.push('/login')">去登录</a>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      baseUrl: 'http://172.18.88.87:20108/api/mobile/register',
      form: {
        email: '',
        code: '',
        password: '',
        nickname: ''
      },
      countdown: 0,
      timer: null,
      emailChecked: false,
      emailAvailable: true,
      loading: false
    }
  },
  methods: {
    // 检查邮箱是否可用
    async checkEmailAvailable() {
      if (!this.form.email) return;
      
      try {
        const response = await fetch(
          `${this.baseUrl}/check_email?email=${this.form.email}`
        );
        const data = await response.json();
        this.emailChecked = true;
        this.emailAvailable = data.data.available;
      } catch (error) {
        console.error('检查邮箱失败', error);
      }
    },

    // 发送验证码
    async sendVerifyCode() {
      if (!this.form.email) {
        this.$message.error('请输入邮箱地址');
        return;
      }

      try {
        const response = await fetch(`${this.baseUrl}/send_code`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({email: this.form.email})
        });

        const data = await response.json();
        
        if (data.status === 200) {
          this.$message.success('验证码已发送，请查收邮件');
          this.startCountdown();
        } else {
          this.$message.error(data.msg);
        }
      } catch (error) {
        this.$message.error('发送失败：' + error.message);
      }
    },

    // 倒计时
    startCountdown() {
      this.countdown = 60;
      this.timer = setInterval(() => {
        this.countdown--;
        if (this.countdown <= 0) {
          clearInterval(this.timer);
        }
      }, 1000);
    },

    // 提交注册
    async handleRegister() {
      if (!this.form.email || !this.form.code || !this.form.password) {
        this.$message.error('请填写完整信息');
        return;
      }

      this.loading = true;

      try {
        const response = await fetch(`${this.baseUrl}/register`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(this.form)
        });

        const data = await response.json();

        if (data.status === 200) {
          this.$message.success('注册成功！');
          // 跳转到登录页
          setTimeout(() => {
            this.$router.push('/login');
          }, 1500);
        } else {
          this.$message.error(data.msg);
        }
      } catch (error) {
        this.$message.error('注册失败：' + error.message);
      } finally {
        this.loading = false;
      }
    }
  },
  beforeUnmount() {
    if (this.timer) {
      clearInterval(this.timer);
    }
  }
}
</script>

<style scoped>
.register-page {
  max-width: 400px;
  margin: 50px auto;
  padding: 20px;
}

.form-item {
  margin-bottom: 15px;
  position: relative;
}

input {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}

button {
  padding: 10px 20px;
  background: #2d8cf0;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

button:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.error {
  color: red;
  font-size: 12px;
  position: absolute;
  bottom: -18px;
}

.login-link {
  text-align: center;
  margin-top: 20px;
  color: #666;
}

.login-link a {
  color: #2d8cf0;
  cursor: pointer;
  text-decoration: none;
}
</style>
```

### 4. React 完整示例

```jsx
import React, { useState, useEffect } from 'react';
import axios from 'axios';

const baseUrl = 'http://172.18.88.87:20108/api/mobile/register';

function RegisterPage() {
  const [form, setForm] = useState({
    email: '',
    code: '',
    password: '',
    nickname: ''
  });
  const [countdown, setCountdown] = useState(0);
  const [emailAvailable, setEmailAvailable] = useState(true);
  const [loading, setLoading] = useState(false);

  // 倒计时
  useEffect(() => {
    if (countdown > 0) {
      const timer = setTimeout(() => setCountdown(countdown - 1), 1000);
      return () => clearTimeout(timer);
    }
  }, [countdown]);

  // 检查邮箱
  const checkEmail = async (email) => {
    if (!email) return;
    try {
      const { data } = await axios.get(`${baseUrl}/check_email?email=${email}`);
      setEmailAvailable(data.data.available);
    } catch (error) {
      console.error('检查邮箱失败', error);
    }
  };

  // 发送验证码
  const sendCode = async () => {
    if (!form.email) {
      alert('请输入邮箱地址');
      return;
    }

    try {
      const { data } = await axios.post(`${baseUrl}/send_code`, {
        email: form.email
      });

      if (data.status === 200) {
        alert('验证码已发送，请查收邮件');
        setCountdown(60);
      } else {
        alert(data.msg);
      }
    } catch (error) {
      alert('发送失败：' + error.message);
    }
  };

  // 提交注册
  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { data } = await axios.post(`${baseUrl}/register`, form);

      if (data.status === 200) {
        alert('注册成功！');
        window.location.href = '/login';
      } else {
        alert(data.msg);
      }
    } catch (error) {
      alert('注册失败：' + error.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="register-page">
      <h2>用户注册</h2>
      <form onSubmit={handleSubmit}>
        <div className="form-item">
          <input
            type="email"
            placeholder="请输入邮箱"
            value={form.email}
            onChange={(e) => setForm({...form, email: e.target.value})}
            onBlur={(e) => checkEmail(e.target.value)}
            required
          />
          {!emailAvailable && <span className="error">该邮箱已被注册</span>}
        </div>

        <div className="form-item">
          <input
            placeholder="请输入验证码"
            value={form.code}
            onChange={(e) => setForm({...form, code: e.target.value})}
            maxLength="6"
            required
          />
          <button 
            type="button" 
            onClick={sendCode}
            disabled={countdown > 0 || !form.email}
          >
            {countdown > 0 ? `${countdown}秒后重试` : '发送验证码'}
          </button>
        </div>

        <div className="form-item">
          <input
            type="password"
            placeholder="请输入密码(6-20位)"
            value={form.password}
            onChange={(e) => setForm({...form, password: e.target.value})}
            minLength="6"
            maxLength="20"
            required
          />
        </div>

        <div className="form-item">
          <input
            placeholder="请输入昵称(可选)"
            value={form.nickname}
            onChange={(e) => setForm({...form, nickname: e.target.value})}
          />
        </div>

        <button type="submit" disabled={loading}>
          {loading ? '注册中...' : '注册'}
        </button>
      </form>

      <div className="login-link">
        已有账号？<a href="/login">去登录</a>
      </div>
    </div>
  );
}

export default RegisterPage;
```

---

## 响应状态码说明

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误或业务逻辑错误 |
| 500 | 服务器内部错误 |

## 错误处理建议

```javascript
async function apiRequest(url, options) {
  try {
    const response = await fetch(url, options);
    const data = await response.json();
    
    if (data.status === 200) {
      return { success: true, data: data.data };
    } else {
      return { success: false, message: data.msg };
    }
  } catch (error) {
    return { success: false, message: '网络请求失败' };
  }
}

// 使用示例
const result = await apiRequest(url, options);
if (result.success) {
  console.log('成功', result.data);
} else {
  alert(result.message);
}
```

---

## 常见问题

### Q1: 验证码收不到怎么办？
1. 检查垃圾邮件箱
2. 确认邮箱地址是否正确
3. 确认是否触发了60秒发送间隔限制
4. 联系管理员检查邮件服务配置

### Q2: 密码强度建议
- 最少6位字符
- 建议包含大小写字母、数字
- 可以包含特殊字符
- 前端做密码强度提示

### Q3: 如何实现记住登录状态？
```javascript
// 登录成功后保存
localStorage.setItem('userInfo', JSON.stringify(data.data));
localStorage.setItem('isLogin', 'true');

// 检查登录状态
function checkLogin() {
  return localStorage.getItem('isLogin') === 'true';
}

// 退出登录
function logout() {
  localStorage.removeItem('userInfo');
  localStorage.removeItem('isLogin');
  window.location.href = '/login';
}
```

---

## 更新日志

**v1.0.0** - 2024-11-11
- ✅ 实现邮箱可用性检查接口
- ✅ 实现发送验证码接口
- ✅ 实现用户注册接口
- ✅ 实现用户登录接口
- ✅ 支持邮件发送功能
- ✅ 密码BCRYPT加密存储

---

## 技术支持

如有问题，请联系后端开发人员或查看项目文档。

